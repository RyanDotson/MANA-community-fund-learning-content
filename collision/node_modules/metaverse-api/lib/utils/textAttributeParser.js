"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function parseBool(val) {
    if (val === 'true' || val === 'false') {
        return val === 'true' ? true : false;
    }
    else {
        throw new Error(`Invalid boolean: ${val}. Booleans must be true or false.`);
    }
}
/**
 * parses a triplet of numbers like "0 1 2" into a vector-like object {x:0,y:1,z:2}
 */
function parseVector3(value) {
    if (typeof value !== 'string' || value.trim().length === 0) {
        throw new Error('Expected Vector3, got: ' + JSON.stringify(value));
    }
    const parts = value.split(/\s+/);
    const vector = { x: parseFloat(parts[0]), y: parseFloat(parts[1]), z: parseFloat(parts[2]) };
    if (isFinite(vector.x) && isFinite(vector.y) && isFinite(vector.z)) {
        return vector;
    }
    else {
        throw new Error(`Invalid Vector3: ${vector.x},${vector.y},${vector.z}. From ${JSON.stringify(value)}`);
    }
}
/**
 * Parses a "key:value;key2:value2" string into a map.
 */
function parseStyle(style) {
    const dict = {};
    style.split(/;+/g).forEach(pair => {
        const parts = pair.split(':', 2);
        const key = parts[0];
        const value = parts.length === 1 ? '' : parts[1];
        if (key.length && value.length) {
            const trimmedKey = key.trim();
            const trimmedValue = value.trim();
            dict[trimmedKey] = trimmedValue;
        }
    });
    return dict;
}
/**
 * Parses a string to milliseconds.
 * @param time 1s or 1000, .5s or 500
 */
function parseTime(time) {
    if (isFinite(time))
        return parseFloat(time);
    if (time
        .toString()
        .trim()
        .endsWith('s')) {
        return parseFloat(time.replace('s', '')) * 1000;
    }
    return parseFloat(time);
}
/**
 * Receives a transition with the format
 * Transition = component duration timing? delay?
 * Transitions = Transition [, Transition]*
 * @param val
 */
function parseTransitions(val) {
    const transitionDefiniions = val.split(/\s*,\s*/);
    const coso = transitionDefiniions.reduce((acc, definition) => {
        const parts = definition.split(/\s+/);
        const component = parts[0];
        return Object.assign({}, acc, { [component]: {
                duration: parseTime(parts[1]),
                timing: parts[2] || 'linear',
                delay: parts[3] ? parseTime(parts[3]) : 0
            } });
    }, {});
    return coso;
}
const parserMappings = {
    position: parseVector3,
    rotation: parseVector3,
    scale: parseVector3,
    visible: parseBool,
    width: parseFloat,
    material: parseStyle,
    sound: parseStyle,
    transition: parseTransitions,
    skeletalAnimation: () => []
};
function camelCase(name) {
    return name.replace(/(?:-([z]))/g, function (whole, part) {
        return part.toUpperCase();
    });
}
function processAttributes(attrs, nodeName) {
    const ret = {};
    for (let i in attrs) {
        const camelCasedName = camelCase(i);
        if (i in parserMappings && typeof attrs[i] === 'string') {
            try {
                ret[camelCasedName] = parserMappings[i](attrs[i]);
            }
            catch (e) {
                // tslint:disable-next-line:no-console
                console.error(`Error parsing HTML attribute: ${i} in node ${nodeName}`, e);
            }
        }
        else {
            ret[camelCasedName] = attrs[i];
        }
    }
    return ret;
}
function processSimplifiedNode(node) {
    return Object.assign({}, node, { attrs: processAttributes(node.attrs, node.tag), children: (node.children && node.children.map(processSimplifiedNode)) || [] });
}
exports.processSimplifiedNode = processSimplifiedNode;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGV4dEF0dHJpYnV0ZVBhcnNlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy90ZXh0QXR0cmlidXRlUGFyc2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBRUEsbUJBQW1CLEdBQVc7SUFDNUIsSUFBSSxHQUFHLEtBQUssTUFBTSxJQUFJLEdBQUcsS0FBSyxPQUFPLEVBQUU7UUFDckMsT0FBTyxHQUFHLEtBQUssTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQTtLQUNyQztTQUFNO1FBQ0wsTUFBTSxJQUFJLEtBQUssQ0FBQyxvQkFBb0IsR0FBRyxtQ0FBbUMsQ0FBQyxDQUFBO0tBQzVFO0FBQ0gsQ0FBQztBQUVEOztHQUVHO0FBQ0gsc0JBQXNCLEtBQW1CO0lBQ3ZDLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxJQUFJLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1FBQzFELE1BQU0sSUFBSSxLQUFLLENBQUMseUJBQXlCLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO0tBQ25FO0lBRUQsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUNoQyxNQUFNLE1BQU0sR0FBcUIsRUFBRSxDQUFDLEVBQUUsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFBO0lBRTlHLElBQUksUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUU7UUFDbEUsT0FBTyxNQUFNLENBQUE7S0FDZDtTQUFNO1FBQ0wsTUFBTSxJQUFJLEtBQUssQ0FBQyxvQkFBb0IsTUFBTSxDQUFDLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLFVBQVUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUE7S0FDdkc7QUFDSCxDQUFDO0FBQ0Q7O0dBRUc7QUFDSCxvQkFBb0IsS0FBYTtJQUMvQixNQUFNLElBQUksR0FBUSxFQUFFLENBQUE7SUFDcEIsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFDaEMsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDaEMsTUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ3BCLE1BQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUVoRCxJQUFJLEdBQUcsQ0FBQyxNQUFNLElBQUksS0FBSyxDQUFDLE1BQU0sRUFBRTtZQUM5QixNQUFNLFVBQVUsR0FBRyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUE7WUFDN0IsTUFBTSxZQUFZLEdBQUcsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFBO1lBQ2pDLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxZQUFZLENBQUE7U0FDaEM7SUFDSCxDQUFDLENBQUMsQ0FBQTtJQUNGLE9BQU8sSUFBSSxDQUFBO0FBQ2IsQ0FBQztBQUNEOzs7R0FHRztBQUNILG1CQUFtQixJQUFTO0lBQzFCLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQztRQUFFLE9BQU8sVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQzNDLElBQ0UsSUFBSTtTQUNELFFBQVEsRUFBRTtTQUNWLElBQUksRUFBRTtTQUNOLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFDaEI7UUFDQSxPQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQTtLQUNoRDtJQUNELE9BQU8sVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFBO0FBQ3pCLENBQUM7QUFFRDs7Ozs7R0FLRztBQUNILDBCQUEwQixHQUFXO0lBQ25DLE1BQU0sb0JBQW9CLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQTtJQUNqRCxNQUFNLElBQUksR0FBRyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsVUFBVSxFQUFFLEVBQUU7UUFDM0QsTUFBTSxLQUFLLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUNyQyxNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDMUIseUJBQ0ssR0FBRyxJQUNOLENBQUMsU0FBUyxDQUFDLEVBQUU7Z0JBQ1gsUUFBUSxFQUFFLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzdCLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksUUFBUTtnQkFDNUIsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQzFDLElBQ0Y7SUFDSCxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUE7SUFFTixPQUFPLElBQUksQ0FBQTtBQUNiLENBQUM7QUFFRCxNQUFNLGNBQWMsR0FBRztJQUNyQixRQUFRLEVBQUUsWUFBWTtJQUN0QixRQUFRLEVBQUUsWUFBWTtJQUN0QixLQUFLLEVBQUUsWUFBWTtJQUNuQixPQUFPLEVBQUUsU0FBUztJQUNsQixLQUFLLEVBQUUsVUFBVTtJQUNqQixRQUFRLEVBQUUsVUFBVTtJQUNwQixLQUFLLEVBQUUsVUFBVTtJQUNqQixVQUFVLEVBQUUsZ0JBQWdCO0lBQzVCLGlCQUFpQixFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUU7Q0FDNUIsQ0FBQTtBQUVELG1CQUFtQixJQUFZO0lBQzdCLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsVUFBUyxLQUFLLEVBQUUsSUFBSTtRQUNyRCxPQUFPLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQTtJQUMzQixDQUFDLENBQUMsQ0FBQTtBQUNKLENBQUM7QUFFRCwyQkFBMkIsS0FBVSxFQUFFLFFBQWdCO0lBQ3JELE1BQU0sR0FBRyxHQUFRLEVBQUUsQ0FBQTtJQUVuQixLQUFLLElBQUksQ0FBQyxJQUFJLEtBQUssRUFBRTtRQUNuQixNQUFNLGNBQWMsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDbkMsSUFBSSxDQUFDLElBQUksY0FBYyxJQUFJLE9BQU8sS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLFFBQVEsRUFBRTtZQUN2RCxJQUFJO2dCQUNGLEdBQUcsQ0FBQyxjQUFjLENBQUMsR0FBSSxjQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO2FBQzNEO1lBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQ1Ysc0NBQXNDO2dCQUN0QyxPQUFPLENBQUMsS0FBSyxDQUFDLGlDQUFpQyxDQUFDLFlBQVksUUFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUE7YUFDM0U7U0FDRjthQUFNO1lBQ0wsR0FBRyxDQUFDLGNBQWMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQTtTQUMvQjtLQUNGO0lBRUQsT0FBTyxHQUFHLENBQUE7QUFDWixDQUFDO0FBRUQsK0JBQXNDLElBQXFCO0lBQ3pELHlCQUNLLElBQUksSUFDUCxLQUFLLEVBQUUsaUJBQWlCLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQzlDLFFBQVEsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFDNUU7QUFDSCxDQUFDO0FBTkQsc0RBTUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWZWN0b3IzQ29tcG9uZW50LCBJU2ltcGxpZmllZE5vZGUsIFRyYW5zaXRpb25WYWx1ZSB9IGZyb20gJy4uJ1xuXG5mdW5jdGlvbiBwYXJzZUJvb2wodmFsOiBzdHJpbmcpIHtcbiAgaWYgKHZhbCA9PT0gJ3RydWUnIHx8IHZhbCA9PT0gJ2ZhbHNlJykge1xuICAgIHJldHVybiB2YWwgPT09ICd0cnVlJyA/IHRydWUgOiBmYWxzZVxuICB9IGVsc2Uge1xuICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBib29sZWFuOiAke3ZhbH0uIEJvb2xlYW5zIG11c3QgYmUgdHJ1ZSBvciBmYWxzZS5gKVxuICB9XG59XG5cbi8qKlxuICogcGFyc2VzIGEgdHJpcGxldCBvZiBudW1iZXJzIGxpa2UgXCIwIDEgMlwiIGludG8gYSB2ZWN0b3ItbGlrZSBvYmplY3Qge3g6MCx5OjEsejoyfVxuICovXG5mdW5jdGlvbiBwYXJzZVZlY3RvcjModmFsdWU6IHN0cmluZyB8IGFueSk6IFZlY3RvcjNDb21wb25lbnQge1xuICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJyB8fCB2YWx1ZS50cmltKCkubGVuZ3RoID09PSAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdFeHBlY3RlZCBWZWN0b3IzLCBnb3Q6ICcgKyBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpXG4gIH1cblxuICBjb25zdCBwYXJ0cyA9IHZhbHVlLnNwbGl0KC9cXHMrLylcbiAgY29uc3QgdmVjdG9yOiBWZWN0b3IzQ29tcG9uZW50ID0geyB4OiBwYXJzZUZsb2F0KHBhcnRzWzBdKSwgeTogcGFyc2VGbG9hdChwYXJ0c1sxXSksIHo6IHBhcnNlRmxvYXQocGFydHNbMl0pIH1cblxuICBpZiAoaXNGaW5pdGUodmVjdG9yLngpICYmIGlzRmluaXRlKHZlY3Rvci55KSAmJiBpc0Zpbml0ZSh2ZWN0b3IueikpIHtcbiAgICByZXR1cm4gdmVjdG9yXG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIFZlY3RvcjM6ICR7dmVjdG9yLnh9LCR7dmVjdG9yLnl9LCR7dmVjdG9yLnp9LiBGcm9tICR7SlNPTi5zdHJpbmdpZnkodmFsdWUpfWApXG4gIH1cbn1cbi8qKlxuICogUGFyc2VzIGEgXCJrZXk6dmFsdWU7a2V5Mjp2YWx1ZTJcIiBzdHJpbmcgaW50byBhIG1hcC5cbiAqL1xuZnVuY3Rpb24gcGFyc2VTdHlsZShzdHlsZTogc3RyaW5nKSB7XG4gIGNvbnN0IGRpY3Q6IGFueSA9IHt9XG4gIHN0eWxlLnNwbGl0KC87Ky9nKS5mb3JFYWNoKHBhaXIgPT4ge1xuICAgIGNvbnN0IHBhcnRzID0gcGFpci5zcGxpdCgnOicsIDIpXG4gICAgY29uc3Qga2V5ID0gcGFydHNbMF1cbiAgICBjb25zdCB2YWx1ZSA9IHBhcnRzLmxlbmd0aCA9PT0gMSA/ICcnIDogcGFydHNbMV1cblxuICAgIGlmIChrZXkubGVuZ3RoICYmIHZhbHVlLmxlbmd0aCkge1xuICAgICAgY29uc3QgdHJpbW1lZEtleSA9IGtleS50cmltKClcbiAgICAgIGNvbnN0IHRyaW1tZWRWYWx1ZSA9IHZhbHVlLnRyaW0oKVxuICAgICAgZGljdFt0cmltbWVkS2V5XSA9IHRyaW1tZWRWYWx1ZVxuICAgIH1cbiAgfSlcbiAgcmV0dXJuIGRpY3Rcbn1cbi8qKlxuICogUGFyc2VzIGEgc3RyaW5nIHRvIG1pbGxpc2Vjb25kcy5cbiAqIEBwYXJhbSB0aW1lIDFzIG9yIDEwMDAsIC41cyBvciA1MDBcbiAqL1xuZnVuY3Rpb24gcGFyc2VUaW1lKHRpbWU6IGFueSkge1xuICBpZiAoaXNGaW5pdGUodGltZSkpIHJldHVybiBwYXJzZUZsb2F0KHRpbWUpXG4gIGlmIChcbiAgICB0aW1lXG4gICAgICAudG9TdHJpbmcoKVxuICAgICAgLnRyaW0oKVxuICAgICAgLmVuZHNXaXRoKCdzJylcbiAgKSB7XG4gICAgcmV0dXJuIHBhcnNlRmxvYXQodGltZS5yZXBsYWNlKCdzJywgJycpKSAqIDEwMDBcbiAgfVxuICByZXR1cm4gcGFyc2VGbG9hdCh0aW1lKVxufVxuXG4vKipcbiAqIFJlY2VpdmVzIGEgdHJhbnNpdGlvbiB3aXRoIHRoZSBmb3JtYXRcbiAqIFRyYW5zaXRpb24gPSBjb21wb25lbnQgZHVyYXRpb24gdGltaW5nPyBkZWxheT9cbiAqIFRyYW5zaXRpb25zID0gVHJhbnNpdGlvbiBbLCBUcmFuc2l0aW9uXSpcbiAqIEBwYXJhbSB2YWxcbiAqL1xuZnVuY3Rpb24gcGFyc2VUcmFuc2l0aW9ucyh2YWw6IHN0cmluZyk6IHsgW2tleTogc3RyaW5nXTogVHJhbnNpdGlvblZhbHVlIH0ge1xuICBjb25zdCB0cmFuc2l0aW9uRGVmaW5paW9ucyA9IHZhbC5zcGxpdCgvXFxzKixcXHMqLylcbiAgY29uc3QgY29zbyA9IHRyYW5zaXRpb25EZWZpbmlpb25zLnJlZHVjZSgoYWNjLCBkZWZpbml0aW9uKSA9PiB7XG4gICAgY29uc3QgcGFydHMgPSBkZWZpbml0aW9uLnNwbGl0KC9cXHMrLylcbiAgICBjb25zdCBjb21wb25lbnQgPSBwYXJ0c1swXVxuICAgIHJldHVybiB7XG4gICAgICAuLi5hY2MsXG4gICAgICBbY29tcG9uZW50XToge1xuICAgICAgICBkdXJhdGlvbjogcGFyc2VUaW1lKHBhcnRzWzFdKSxcbiAgICAgICAgdGltaW5nOiBwYXJ0c1syXSB8fCAnbGluZWFyJyxcbiAgICAgICAgZGVsYXk6IHBhcnRzWzNdID8gcGFyc2VUaW1lKHBhcnRzWzNdKSA6IDBcbiAgICAgIH1cbiAgICB9XG4gIH0sIHt9KVxuXG4gIHJldHVybiBjb3NvXG59XG5cbmNvbnN0IHBhcnNlck1hcHBpbmdzID0ge1xuICBwb3NpdGlvbjogcGFyc2VWZWN0b3IzLFxuICByb3RhdGlvbjogcGFyc2VWZWN0b3IzLFxuICBzY2FsZTogcGFyc2VWZWN0b3IzLFxuICB2aXNpYmxlOiBwYXJzZUJvb2wsXG4gIHdpZHRoOiBwYXJzZUZsb2F0LFxuICBtYXRlcmlhbDogcGFyc2VTdHlsZSxcbiAgc291bmQ6IHBhcnNlU3R5bGUsXG4gIHRyYW5zaXRpb246IHBhcnNlVHJhbnNpdGlvbnMsXG4gIHNrZWxldGFsQW5pbWF0aW9uOiAoKSA9PiBbXVxufVxuXG5mdW5jdGlvbiBjYW1lbENhc2UobmFtZTogc3RyaW5nKSB7XG4gIHJldHVybiBuYW1lLnJlcGxhY2UoLyg/Oi0oW3pdKSkvZywgZnVuY3Rpb24od2hvbGUsIHBhcnQpIHtcbiAgICByZXR1cm4gcGFydC50b1VwcGVyQ2FzZSgpXG4gIH0pXG59XG5cbmZ1bmN0aW9uIHByb2Nlc3NBdHRyaWJ1dGVzKGF0dHJzOiBhbnksIG5vZGVOYW1lOiBzdHJpbmcpIHtcbiAgY29uc3QgcmV0OiBhbnkgPSB7fVxuXG4gIGZvciAobGV0IGkgaW4gYXR0cnMpIHtcbiAgICBjb25zdCBjYW1lbENhc2VkTmFtZSA9IGNhbWVsQ2FzZShpKVxuICAgIGlmIChpIGluIHBhcnNlck1hcHBpbmdzICYmIHR5cGVvZiBhdHRyc1tpXSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldFtjYW1lbENhc2VkTmFtZV0gPSAocGFyc2VyTWFwcGluZ3MgYXMgYW55KVtpXShhdHRyc1tpXSlcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWNvbnNvbGVcbiAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgcGFyc2luZyBIVE1MIGF0dHJpYnV0ZTogJHtpfSBpbiBub2RlICR7bm9kZU5hbWV9YCwgZSlcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0W2NhbWVsQ2FzZWROYW1lXSA9IGF0dHJzW2ldXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJldFxufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJvY2Vzc1NpbXBsaWZpZWROb2RlKG5vZGU6IElTaW1wbGlmaWVkTm9kZSk6IElTaW1wbGlmaWVkTm9kZSB7XG4gIHJldHVybiB7XG4gICAgLi4ubm9kZSxcbiAgICBhdHRyczogcHJvY2Vzc0F0dHJpYnV0ZXMobm9kZS5hdHRycywgbm9kZS50YWcpLFxuICAgIGNoaWxkcmVuOiAobm9kZS5jaGlsZHJlbiAmJiBub2RlLmNoaWxkcmVuLm1hcChwcm9jZXNzU2ltcGxpZmllZE5vZGUpKSB8fCBbXVxuICB9XG59XG4iXX0=